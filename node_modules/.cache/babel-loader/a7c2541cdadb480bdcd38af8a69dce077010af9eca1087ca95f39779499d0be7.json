{"ast":null,"code":"import _slicedToArray from\"C:/Users/Genxhire/Projects/Website/esurveillance-local-tracker/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import jwt_decode from\"jwt-decode\";import Error from'./pages/error';import Home from'./pages/homes';import React,{useEffect,useState}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState('Initial'),_useState2=_slicedToArray(_useState,2),screen=_useState2[0],setScreen=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),location=_useState4[0],setLocation=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),name=_useState6[0],setName=_useState6[1];var queryParameters=new URLSearchParams(window.location.search);var token=queryParameters.get('token');// const [PermissionStatus, setPermissionStatus] = useState('')\nvar checkPermission=React.useCallback(function(){if('geolocation'in navigator){navigator.permissions.query({name:'geolocation'}).then(function(result){if(result.state===\"granted\"){setScreen('Home');}else if(result.state==='prompt'){setScreen('No-GPS');requestPermission();}else{setScreen('Error');}}).catch(function(error){console.error('Error checking location permission:',error);});}else{setScreen('No-GPS');}},[]);useEffect(function(){try{var decoded=jwt_decode(token);console.log(decoded);setName(decoded.name);var expiryTime=decoded.exp;var currentTime=Math.floor(Date.now()/1000);if(currentTime<expiryTime){checkPermission();}else{setScreen('Expired');}}catch(error){setScreen('Invalid');}},[token,checkPermission]);var requestPermission=function requestPermission(){navigator.geolocation.getCurrentPosition(function(position){console.log(position);setScreen('Home');},function(error){console.log(\"This is an error.\");console.log(error);},{enableHighAccuracy:true,timeout:5000});};var getLocation=React.useCallback(function(){if(!navigator.geolocation){console.log(\"Geolocation is not supported by your browser\");}else{navigator.geolocation.getCurrentPosition(function(position){console.log(position);setScreen('Home');});}},[]);switch(screen){case'Initial':return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Error,{image:'expired.svg',title:'Please Wait',subTitle:'Loading'})});case'Home':return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Home,{name:name})});case'Expired':return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Error,{image:'expired.svg',title:'Oops, this link is expired!',subTitle:'Please request a new link from an administrator'})});case'Invalid':return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Error,{image:'invalid.svg',title:'Test',subTitle:'Test SubTitle'})});case'No-GPS':return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Error,{image:'no_gps.svg',title:'No GPS!',subTitle:\"Satellite can't find you\"}),/*#__PURE__*/_jsx(\"button\",{onClick:getLocation,children:\"get location\"})]});default:return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Error,{image:'no_gps.svg',title:'Error',subTitle:\"Something went wrong\"}),/*#__PURE__*/_jsx(\"button\",{onClick:getLocation,children:\"get location\"})]});}}export default App;","map":{"version":3,"names":["jwt_decode","Error","Home","React","useEffect","useState","jsx","_jsx","jsxs","_jsxs","App","_useState","_useState2","_slicedToArray","screen","setScreen","_useState3","_useState4","location","setLocation","_useState5","_useState6","name","setName","queryParameters","URLSearchParams","window","search","token","get","checkPermission","useCallback","navigator","permissions","query","then","result","state","requestPermission","catch","error","console","decoded","log","expiryTime","exp","currentTime","Math","floor","Date","now","geolocation","getCurrentPosition","position","enableHighAccuracy","timeout","getLocation","children","image","title","subTitle","onClick"],"sources":["C:/Users/Genxhire/Projects/Website/esurveillance-local-tracker/src/App.js"],"sourcesContent":["import jwt_decode from \"jwt-decode\";\nimport Error from './pages/error';\nimport Home from './pages/homes';\nimport React, { useEffect, useState } from 'react';\n\n\n\nfunction App() {\n  const [screen, setScreen] = useState('Initial');\n  const [location, setLocation] = useState('');\n  const [name, setName] = useState('');\n  const queryParameters = new URLSearchParams(window.location.search);\n  const token = queryParameters.get('token');\n// const [PermissionStatus, setPermissionStatus] = useState('')\nconst checkPermission = React.useCallback(()=>{\n\n  if('geolocation' in navigator){\n    navigator.permissions.query({name: 'geolocation'}).then(result => {\n       if(result.state === \"granted\"){\n         setScreen('Home');\n       }else if(result.state === 'prompt'){\n        setScreen('No-GPS');\n        requestPermission()\n       } else{\n        setScreen('Error')\n       }\n    }).catch(error => {\n      console.error('Error checking location permission:', error);\n    });\n  }\n  else{\n    setScreen('No-GPS')\n  }\n},[]);\n\n  useEffect(() => {\n    try {\n      const decoded = jwt_decode(token);\n      console.log(decoded);\n      setName(decoded.name);\n      const expiryTime = decoded.exp;\n      const currentTime = Math.floor(Date.now() / 1000);\n      if (currentTime < expiryTime) {\n        checkPermission();\n      } else {\n        setScreen('Expired');\n      }\n    } catch (error) {\n      setScreen('Invalid');\n    }\n  },[token, checkPermission]);\n\n\n  const requestPermission = () => {\n    navigator.geolocation.getCurrentPosition(\n      (position)=>{\n        console.log(position);\n        setScreen('Home') \n      },\n      (error)=>{\n        console.log(\"This is an error.\")\n        console.log(error)\n      },\n      { enableHighAccuracy: true, timeout: 5000 }\n    );\n  }\n\n  const getLocation = React.useCallback(() => {\n    if (!navigator.geolocation) {\n      console.log(\"Geolocation is not supported by your browser\");\n    } else {\n      navigator.geolocation.getCurrentPosition((position) =>{\n        console.log(position);\n        setScreen('Home')\n      });\n    }\n  }, [])\n\n  switch (screen) {\n    case 'Initial':\n      return (\n        <div>\n          <Error image={'expired.svg'} title={'Please Wait'} subTitle={'Loading'} />\n        </div>\n      );\n    case 'Home':\n      return (\n        <div>\n          <Home name={name} />\n        </div>\n      );\n    case 'Expired':\n      return (\n        <div>\n          <Error\n            image={'expired.svg'}\n            title={'Oops, this link is expired!'}\n            subTitle={'Please request a new link from an administrator'}\n          />\n        </div>\n      );\n    case 'Invalid':\n      return (\n        <div>\n          <Error image={'invalid.svg'} title={'Test'} subTitle={'Test SubTitle'} />\n        </div>\n      );\n    case 'No-GPS':\n      return (\n        <div>\n          <Error image={'no_gps.svg'} title={'No GPS!'} subTitle={\"Satellite can't find you\"} />\n          <button onClick={getLocation}>get location</button>\n        </div>\n      );\n    default:\n      return (\n        <div>\n          <Error image={'no_gps.svg'} title={'Error'} subTitle={\"Something went wrong\"} />\n          <button onClick={getLocation}>get location</button>\n        </div>\n      );\n  }\n\n}\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}